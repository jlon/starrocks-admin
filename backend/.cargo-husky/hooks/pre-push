#!/usr/bin/env bash
# Git pre-push hook for Rust backend
# Following rustfs standard: fmt + clippy + check

set -e

echo "[pre-push] Running Rust pre-push checks..."

# 1. Check code formatting
echo "[pre-push] Checking code formatting..."
cargo fmt --all --check

# 2. Run clippy (strict mode)
echo "[pre-push] Running clippy checks..."
DATABASE_URL="sqlite:../build/data/starrocks-admin.db" cargo clippy --all-targets --all-features -- -D warnings

# 3. Run cargo check
echo "[pre-push] Running cargo check..."
cargo check --all-targets

echo "[pre-push] All Rust pre-push checks passed!"

