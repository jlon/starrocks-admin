<div class="row">
  <div class="col-12">
    <nb-card>
      <nb-card-header>
        <div class="d-flex justify-content-between align-items-center">
          <span>{{ 'sql_blacklist.title' | translate }}</span>
          <div class="d-flex align-items-center gap-2">
            <button nbButton status="basic" size="small" (click)="loadBlacklist()" [disabled]="loading">
              <nb-icon icon="refresh-outline"></nb-icon>
              {{ 'common.refresh' | translate }}
            </button>
            <button nbButton status="primary" size="small" (click)="openAddDialog()">
              <nb-icon icon="plus-outline"></nb-icon>
              {{ 'sql_blacklist.add_rule' | translate }}
            </button>
          </div>
        </div>
      </nb-card-header>
      <nb-card-body>
        <p class="text-hint mb-3">
          {{ 'sql_blacklist.description' | translate }}
        </p>
        <div *ngIf="loading" class="text-center mt-3">
          <nb-spinner status="primary" [message]="''"></nb-spinner>
        </div>
        <ng2-smart-table
          *ngIf="!loading"
          [settings]="blacklistSettings"
          [source]="blacklistSource"
          (delete)="onDeleteConfirm($event)"
        ></ng2-smart-table>
      </nb-card-body>
    </nb-card>
  </div>
</div>

<!-- Add Blacklist Dialog -->
<ng-template #blacklistDialog let-ref="dialogRef">
  <nb-card class="blacklist-dialog">
    <nb-card-header>
      <div class="d-flex justify-content-between align-items-center">
          <h5>{{ 'sql_blacklist.dialog.title' | translate }}</h5>
        <button nbButton ghost (click)="cancelDialog()">
          <nb-icon icon="close-outline"></nb-icon>
        </button>
      </div>
    </nb-card-header>
    <nb-card-body>
      <nb-accordion class="mb-3">
        <nb-accordion-item>
          <nb-accordion-item-header>
            <div class="d-flex align-items-center">
              <nb-icon icon="code-outline" status="primary" class="mr-2"></nb-icon>
              {{ 'sql_blacklist.dialog.templates_title' | translate }}
              <nb-badge status="info" class="ml-2">
                {{ 'sql_blacklist.dialog.templates_count' | translate:{ count: exampleTemplates.length } }}
              </nb-badge>
            </div>
          </nb-accordion-item-header>
          <nb-accordion-item-body>
            <div class="template-list">
              <div class="template-item" *ngFor="let template of exampleTemplates; trackBy: trackTemplate">
                <div class="template-header">
                  <div class="template-info">
                    <nb-icon [icon]="template.icon" status="basic" class="template-icon"></nb-icon>
                    <div class="template-text">
                      <span class="template-title">{{template.title}}</span>
                      <small class="template-desc">{{template.description}}</small>
                    </div>
                  </div>
                  <button
                    nbButton
                          ghost 
                          size="tiny" 
                          status="basic"
                          (click)="useTemplate(template)"
                    [title]="'sql_blacklist.dialog.use_template' | translate"
                  >
                    <nb-icon icon="copy-outline"></nb-icon>
                  </button>
                </div>
                <div class="template-code-block">
                  <code>{{template.pattern}}</code>
                </div>
              </div>
            </div>
          </nb-accordion-item-body>
        </nb-accordion-item>
      </nb-accordion>

      <div class="form-group mt-3">
        <label class="label">
          {{ 'sql_blacklist.dialog.pattern_label' | translate }}
          <span class="text-danger">*</span>
        </label>
        <textarea
          nbInput
          fullWidth
          rows="4"
          [placeholder]="'sql_blacklist.dialog.pattern_placeholder' | translate"
          [(ngModel)]="newBlacklistPattern"
          [disabled]="loading"
        ></textarea>
        <small class="form-text text-muted">
          <nb-icon icon="bulb-outline"></nb-icon>
          {{ 'sql_blacklist.dialog.pattern_hint' | translate }}
        </small>
      </div>
    </nb-card-body>
    <nb-card-footer>
      <div class="d-flex justify-content-end gap-2">
        <button nbButton status="basic" (click)="cancelDialog()" [disabled]="loading">
          {{ 'common.cancel' | translate }}
        </button>
        <button
          nbButton
          status="primary"
          (click)="submitPattern()"
          [disabled]="loading || !newBlacklistPattern.trim()"
        >
          <nb-icon icon="checkmark-outline"></nb-icon>
          {{ 'common.confirm' | translate }}
        </button>
      </div>
    </nb-card-footer>
  </nb-card>
</ng-template>
